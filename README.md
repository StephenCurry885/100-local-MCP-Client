# ğŸ§  100% æœ¬åœ° MCP å®¢æˆ·ç«¯ + SQLite æœåŠ¡å™¨ï¼ˆLlamaIndex + Ollama + Qwen2.5 / DeepSeek-R1ï¼‰

## ğŸ§© æŠ€æœ¯æ ˆä¸åŸç†è¯´æ˜

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ª **å®Œå…¨æœ¬åœ°è¿è¡Œçš„ MCPï¼ˆModel Context Protocolï¼‰å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç³»ç»Ÿ**ã€‚

---

### ğŸš€ æŠ€æœ¯æ ˆ

* **LlamaIndex**ï¼šç”¨äºæ„å»ºåŸºäº MCP åè®®çš„æ™ºèƒ½ä½“ï¼ˆFunctionAgentï¼‰ã€‚
* **Ollama**ï¼šæä¾›æœ¬åœ°å¤§è¯­è¨€æ¨¡å‹ï¼ˆæ¨èä½¿ç”¨ `Qwen2.5:7b-instruct`ï¼ŒDeepSeek-R1 ä»…ä½œå…¼å®¹æµ‹è¯•ï¼‰ã€‚
* **LightningAI**ï¼šè´Ÿè´£è¿è¡Œä¸æ‰˜ç®¡å·¥ä½œæµï¼ˆå¯é€‰ï¼Œæœ¬åœ°è¿è¡Œæ—¶æœªå¯ç”¨è¿œç¨‹æ‰˜ç®¡ï¼‰ã€‚
* **SQLite**ï¼šè½»é‡çº§æœ¬åœ°æ•°æ®åº“ï¼Œç”¨ä½œæ¼”ç¤ºæ€§åç«¯ã€‚
* **MCP Protocol**ï¼šå®ç° Host â†” Client â†” Server çš„æ ‡å‡†é€šä¿¡æœºåˆ¶ï¼ˆæœ¬åœ° SSEï¼‰ã€‚

---

### âš™ï¸ å·¥ä½œæµåŸç†

1. ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼›
2. æ™ºèƒ½ä½“ï¼ˆFunctionAgentï¼‰åŸºäºæç¤ºè¯ä¸å·¥å…·æè¿°ï¼Œ**åˆ¤æ–­æ˜¯å¦è°ƒç”¨å·¥å…·**ï¼›
3. MCP å®¢æˆ·ç«¯é€šè¿‡ SSE è¿æ¥åˆ° MCP æœåŠ¡å™¨ï¼›
4. æœåŠ¡å™¨æä¾›å·¥å…·ï¼ˆå¦‚ `add_data` ä¸ `read_data`ï¼‰å¹¶æ‰§è¡Œå¯¹åº” SQLï¼›
5. æ‰§è¡Œç»“æœå›ä¼ ç»™ä»£ç†ï¼›
6. æ¨¡å‹ç»“åˆä¸Šä¸‹æ–‡ç”Ÿæˆæœ€ç»ˆè‡ªç„¶è¯­è¨€å›å¤ã€‚

---

### ğŸ§  é¡¹ç›®æ•´ä½“æ¶æ„
![é¡¹ç›®ç»“æ„å›¾](./images/ç»“æ„å›¾.png)
---

### ğŸ“˜ å®ç°æ­¥éª¤æ¦‚è§ˆ

| æ­¥éª¤ | å†…å®¹                | è¯´æ˜                                     |
| -- | ----------------- | -------------------------------------- |
| #1 | æ„å»º SQLite MCP æœåŠ¡å™¨ | æä¾›ä¸¤ä¸ªåŸºç¡€å·¥å…·ï¼šæ·»åŠ æ•°æ® / æŸ¥è¯¢æ•°æ®                   |
| #2 | è®¾ç½® LLM            | ä½¿ç”¨ Ollama è°ƒç”¨æœ¬åœ°æ¨¡å‹ï¼ˆæ¨è Qwen2.5:7bï¼‰        |
| #3 | å®šä¹‰ç³»ç»Ÿæç¤º            | æŒ‡å¯¼ä»£ç†å¦‚ä½•åˆ¤æ–­ä¸ä½¿ç”¨ MCP å·¥å…·                     |
| #4 | å®šä¹‰ä»£ç†              | é€šè¿‡ LlamaIndex å°è£… MCP å·¥å…·ä¸º FunctionAgent |
| #5 | å®šä¹‰ä»£ç†äº¤äº’            | ç®¡ç†ç”¨æˆ·è¾“å…¥ã€æµå¼äº‹ä»¶å’Œå·¥å…·è°ƒç”¨                       |
| #6 | åˆå§‹åŒ– MCP å®¢æˆ·ç«¯ä¸ä»£ç†    | åŠ è½½å·¥å…·å¹¶å»ºç«‹ä¸æœåŠ¡å™¨çš„ SSE è¿æ¥                    |
| #7 | è¿è¡Œä»£ç†              | ç”¨æˆ·äº¤äº’ â†’ æ™ºèƒ½ä½“å†³ç­– â†’ å·¥å…·æ‰§è¡Œ â†’ è‡ªç„¶è¯­è¨€è¾“å‡º           |

---

æœ¬é¡¹ç›®å±•ç¤ºäº†ä¸€ä¸ª **å®Œå…¨æœ¬åœ°è¿è¡Œ** çš„æœ€å°å¯ç”¨ç¤ºä¾‹ï¼š

* âœ… **MCP Server**ï¼šæš´éœ²æ•°æ®åº“è¯»å†™å·¥å…·ï¼ˆåŸºäº SQLiteï¼‰
* âœ… **MCP Client**ï¼šå°è£…ä¸º LlamaIndex FunctionAgent
* âœ… **LLM**ï¼šé€šè¿‡ Ollama è°ƒç”¨æœ¬åœ°æ¨¡å‹ï¼ˆæ¨è `qwen2.5:7b-instruct`ï¼‰

æ•´ä¸ªæµç¨‹åœ¨æœ¬æœºå®Œæˆï¼Œæ— éœ€å¤–éƒ¨ APIã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
local-mcp-demo/
â”œâ”€â”€ README_zh.md                # è¿è¡Œè¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ server/
â”‚   â””â”€â”€ server.py               # #1 SQLite MCP æœåŠ¡å™¨ï¼ˆSSE / stdio äºŒé€‰ä¸€ï¼‰
â””â”€â”€ client/
    â”œâ”€â”€ ollama_client.py        # #2~#7 MCP å®¢æˆ·ç«¯ + LlamaIndex ä»£ç†
    â””â”€â”€ system_prompt.txt       # #3 ç³»ç»Ÿæç¤ºè¯ï¼ˆå®šä¹‰å·¥å…·ä½¿ç”¨ç­–ç•¥ï¼‰
```

---

## âš™ï¸ ç¯å¢ƒå‡†å¤‡

### 1ï¸âƒ£ Python ç¯å¢ƒ

* Python **3.10+**
* å»ºè®®ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

```bash
python -m venv .venv
source .venv/bin/activate      # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

> è‹¥å›½å†…ç½‘ç»œè¾ƒæ…¢ï¼Œå¯ä½¿ç”¨æ¸…åé•œåƒï¼š
>
> ```
> pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
> ```

---

### 2ï¸âƒ£ å®‰è£… Ollamaï¼ˆæœ¬åœ°æ¨¡å‹è¿è¡Œæ—¶ï¼‰

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® [https://ollama.ai/download](https://ollama.ai/download)
2. ä¸‹è½½å¯¹åº”å¹³å°çš„å®‰è£…åŒ…å¹¶å®‰è£…ï¼ˆWindows/macOS/Linuxï¼‰
3. å®‰è£…å®Œæˆåï¼Œæ‰“å¼€ç»ˆç«¯éªŒè¯ï¼š

   ```bash
   ollama --version
   ```

   å‡ºç°ç‰ˆæœ¬å·å³å®‰è£…æˆåŠŸã€‚

---

### 3ï¸âƒ£ æ‹‰å–æ”¯æŒå‡½æ•°è°ƒç”¨çš„æ¨¡å‹ï¼ˆéå¸¸é‡è¦ï¼‰

> âš ï¸ **DeepSeek-R1 å®˜æ–¹æ¨¡å‹é»˜è®¤ä¸æ”¯æŒ Function Calling**
> å³ä½¿æ˜¯ `1.5b` / `7b` ç‰ˆæœ¬ï¼Œä¹Ÿå¯èƒ½æ— æ³•è®©ä»£ç†è‡ªåŠ¨è§¦å‘ MCP å·¥å…·è°ƒç”¨ã€‚
> **å»ºè®®ä½¿ç”¨ `qwen2.5:7b-instruct` æ¨¡å‹**ï¼ˆæ”¯æŒå·¥å…·è°ƒç”¨ï¼‰ã€‚

```bash
# æ¨èæ¨¡å‹ï¼ˆæ”¯æŒ Function Callingï¼‰
ollama pull qwen2.5:7b-instruct
# å¯æ›¿æ¢ä¸ºå…¶ä»–æ”¯æŒå‡½æ•°è°ƒç”¨çš„æ¨¡å‹ï¼š
# ollama pull llama3.1:8b-instruct
# ollama pull mistral:7b-instruct
```

å¯éªŒè¯æ˜¯å¦ä¸‹è½½æˆåŠŸï¼š

```bash
ollama list
```

> **æ³¨æ„ï¼š**
>
> * DeepSeek-R1:1.5b è™½ç„¶æ ‡ç§°æ”¯æŒå·¥å…·è°ƒç”¨ï¼Œä½†å®é™…æµ‹è¯•ä¸­å¹¶ä¸ç¨³å®šï¼›
> * 7B ç‰ˆæœ¬çš„ DeepSeek-R1 åœ¨ç›¸åŒæ¡ä»¶ä¸‹æ”¯æŒåº¦æ›´é«˜ï¼Œä½†èµ„æºå ç”¨ä¹Ÿæ›´å¤§ï¼›
> * Qwen2.5:7b-instruct æ¨¡å‹æ”¯æŒæœ€å®Œå–„ã€‚

---

## ğŸš€ è¿è¡Œæ­¥éª¤

### ğŸ§© Step 1. å¯åŠ¨ SQLite MCP æœåŠ¡å™¨

`server/server.py` å®ç°äº†ä¸¤ä¸ªå·¥å…·ï¼š

* `add_data(query: str) -> bool`ï¼šæ‰§è¡Œ `INSERT/UPDATE/DELETE`
* `read_data(query: str = "SELECT * FROM people") -> list`ï¼šæ‰§è¡Œ `SELECT`

#### å¯åŠ¨å‘½ä»¤ï¼š

```bash
cd server
python server.py --db ../demo.db --transport sse
```

çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºè¯´æ˜æˆåŠŸï¼š

```
âœ… SQLite DB: D:\Projects\MCP\demo.db
ğŸš€ MCP SQLite server running on SSE http://127.0.0.1:8000/sse
```

> âœ… å¯åŠ¨åä¼šè‡ªåŠ¨åˆ›å»ºç¤ºä¾‹è¡¨ `people(name, age, profession)`ã€‚

---

### ğŸ§  Step 2. è®¾ç½® LLMï¼ˆOllamaï¼‰

`client/ollama_client.py` é»˜è®¤æ¨¡å‹ï¼š

```python
MODEL_NAME = "qwen2.5:7b-instruct"
```

å¦‚ä½ ä¸‹è½½äº†å…¶ä»–æ¨¡å‹ï¼ˆä¾‹å¦‚ DeepSeek-R1ï¼‰ï¼Œå¯è‡ªè¡Œä¿®æ”¹ã€‚

---

### ğŸ“œ Step 3. å®šä¹‰ç³»ç»Ÿæç¤ºè¯ï¼ˆSystem Promptï¼‰

`client/system_prompt.txt` ä¸­å®šä¹‰äº†æ¨¡å‹çš„**è§’è‰²ä¸å·¥å…·ä½¿ç”¨è§„åˆ™**ã€‚
ä¾‹å¦‚ï¼š

```
- å½“ç”¨æˆ·æåˆ°â€œæ·»åŠ â€/â€œæ’å…¥â€ï¼Œè°ƒç”¨ add_dataï¼›
- å½“ç”¨æˆ·æåˆ°â€œæŸ¥è¯¢â€/â€œè·å–â€ï¼Œè°ƒç”¨ read_dataï¼›
- è°ƒç”¨æˆåŠŸåè¯·è¿”å›ç®€æ´ç»“æœï¼Œä¸é‡å¤è°ƒç”¨ï¼›
```

> åˆ é™¤è¯¥æ–‡ä»¶æˆ–æ¸…ç©ºå†…å®¹ä¼šå¯¼è‡´æ¨¡å‹æ— æ³•åˆ¤æ–­ä½•æ—¶è°ƒç”¨å·¥å…·ï¼ˆè¯¦è§ä¸‹æ–‡â€œåŸç†è§£é‡Šâ€ï¼‰ã€‚

---

### ğŸ¤– Step 4. å®šä¹‰ä»£ç†ï¼ˆFunctionAgentï¼‰

`client/ollama_client.py` ä½¿ç”¨ï¼š

* `llama_index.tools.mcp` å°† MCP å·¥å…·åŒ…è£…ä¸º LlamaIndex åŸç”Ÿå·¥å…·ï¼›
* `FunctionAgent` æ„å»ºå‡½æ•°è°ƒç”¨ä»£ç†ï¼ˆfunction-calling agentï¼‰ã€‚

ä»£ç†è´Ÿè´£ï¼š

* å†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·ï¼›
* è°ƒç”¨åæ•´åˆç»“æœï¼›
* ç”Ÿæˆè‡ªç„¶è¯­è¨€å›ç­”ã€‚

---

### ğŸ’¬ Step 5. å®šä¹‰ä»£ç†äº¤äº’

`handle_user_message(...)`ï¼š

* å°†ç”¨æˆ·è¾“å…¥ä¼ å…¥ä»£ç†ï¼›
* æ‰“å°å·¥å…·è°ƒç”¨äº‹ä»¶ï¼ˆ`[Event] ToolCall -> ...`ï¼‰ï¼›
* è¿”å›è‡ªç„¶è¯­è¨€ç»“æœã€‚

---

### âš™ï¸ Step 6. åˆå§‹åŒ– MCP å®¢æˆ·ç«¯ä¸ä»£ç†

```python
mcp_client = BasicMCPClient("http://127.0.0.1:8000/sse")
mcp_tool = McpToolSpec(client=mcp_client)
tools = await mcp_tool.to_tool_list_async()
agent = FunctionAgent(tools=tools, llm=llm, system_prompt=SYSTEM_PROMPT)
```

---

### ğŸ§‘â€ğŸ’» Step 7. å¯åŠ¨å®¢æˆ·ç«¯ä¸æ¨¡å‹ä»£ç†

å¦å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œä¿æŒæœåŠ¡å™¨è¿è¡Œï¼š

```bash
cd client
source ../.venv/bin/activate     # Windows ç”¨ .venv\Scripts\activate
python ollama_client.py
```

è¾“å…¥ç¤ºä¾‹ï¼š

```
æ·»åŠ åˆ°æ•°æ®åº“ï¼šINSERT INTO people(name, age, profession) VALUES('Rafael Nadal', 39, 'Tennis Player')
```

é¢„æœŸè¾“å‡ºï¼ˆéƒ¨åˆ†ç¤ºä¾‹ï¼‰ï¼š

```
[Event] AgentInput
[Event] AgentStream
[Event] ToolCall -> add_data
[Event] AgentOutput
Agent: æˆåŠŸæ·»åŠ  Rafael Nadal åˆ°æ•°æ®åº“ã€‚
```

å†è¾“å…¥ï¼š

```
è·å–æ•°æ®
```

æˆ–ï¼š

```
æŸ¥è¯¢: SELECT * FROM people
```

è¾“å‡ºï¼š

```
[Event] ToolCall -> read_data
Agent: æŸ¥è¯¢åˆ° 1 æ¡è®°å½•ï¼š
- Rafael Nadalï¼ˆ39 å²ï¼ŒTennis Playerï¼‰
```

---

## ğŸª å¸¸è§é—®é¢˜ä¸è§£å†³

| é—®é¢˜                  | åŸå›                           | è§£å†³æ–¹æ¡ˆ                                       |
| ------------------- | --------------------------- | ------------------------------------------ |
| æ¨¡å‹ä¸æ–­è°ƒç”¨å·¥å…·            | æ²¡æœ‰é™åˆ¶å¾ªç¯æ¬¡æ•°                    | åœ¨ `FunctionAgent` è®¾ç½® `max_steps=3`         |
| æ¨¡å‹åˆ¤å®šé”™è¯¯ï¼ˆä¸è°ƒç”¨å·¥å…·ï¼‰       | system_prompt è¢«åˆ é™¤æˆ–æ¨¡å‹ä¸æ”¯æŒå·¥å…·è°ƒç”¨ | æ¢å¤ system_promptï¼Œæˆ–ä½¿ç”¨ `qwen2.5:7b-instruct` |
| æŸ¥è¯¢ä¸åˆ°æ•°æ®              | å·¥å…·æ²¡æ‰§è¡Œï¼ˆåªè¾“å‡º JSONï¼‰             | æ¢æ”¯æŒ Function Calling çš„æ¨¡å‹                   |
| æŠ¥ â€œnear '*'â€ SQL é”™è¯¯ | æ¨¡å‹è¾“å‡ºå«å…¨è§’ç¬¦å· / ä»£ç å›´æ             | åœ¨æœåŠ¡å™¨ç«¯æ¸…æ´— SQLï¼ˆè§ `server.py` ä¸­ `_clean_sql`ï¼‰  |
| LLM è¾“å‡ºä¸­æ–‡ä¹±ç           | Ollama æ§åˆ¶å°å­—ç¬¦é›†é—®é¢˜             | ä½¿ç”¨ UTF-8 ç»ˆç«¯æˆ– VSCode ç»ˆç«¯                     |
| æ˜¾å­˜ä¸è¶³                | æ¨¡å‹å¤ªå¤§                        | æ¢å°å‚æ•°æ¨¡å‹ï¼ˆå¦‚ qwen2.5:1.8bï¼‰                     |

---

## ğŸ’¡ æŠ€æœ¯åŸç†ç®€è¿°

* **MCP Server**ï¼šå°è£… SQLite å·¥å…·ï¼ˆadd / readï¼‰ï¼Œæš´éœ²ä¸ºæ ‡å‡† MCP æ¥å£ï¼ˆSSE / stdioï¼‰ã€‚
* **MCP Client**ï¼šé€šè¿‡ `BasicMCPClient` ä¸æœåŠ¡å™¨é€šä¿¡ã€‚
* **LlamaIndex Agent**ï¼šæ¥æ”¶ç”¨æˆ·è¾“å…¥ â†’ è°ƒç”¨æœ¬åœ° LLM â†’ ç”± LLM åˆ¤æ–­æ˜¯å¦ã€ä»¥åŠå¦‚ä½•è°ƒç”¨å·¥å…·ã€‚
* **System Prompt**ï¼šæŒ‡å¯¼æ¨¡å‹å†³ç­–ï¼ˆæ˜¯å·¥å…·è°ƒç”¨çš„â€œè¯´æ˜ä¹¦â€ï¼‰ã€‚
* **LLMï¼ˆOllamaï¼‰**ï¼šæ‰§è¡Œæ¨ç†ï¼Œè¾“å‡ºå‡½æ•°è°ƒç”¨æˆ–è‡ªç„¶è¯­è¨€ã€‚

> å¦‚æœåˆ é™¤ `system_prompt.txt`ï¼Œæ¨¡å‹å°†å¤±å»å·¥å…·ä½¿ç”¨è¯´æ˜ï¼Œå› æ­¤æ— æ³•å†â€œè‡ªä¸»åˆ¤å®šâ€è°ƒç”¨å‡½æ•°ã€‚

---

## ğŸ§© æˆ‘ä»¬çš„æ”¹è¿›ä¸ç»éªŒæ€»ç»“

* âœ… è‡ªå»º MCP Server å®ç°æ•°æ®åº“è®¿é—®ï¼›
* âœ… FunctionAgent å¯æ ¹æ®è‡ªç„¶è¯­è¨€æ„å›¾è‡ªåŠ¨é€‰æ‹© `add_data` / `read_data`ï¼›
* âœ… Qwen2.5:7b-instruct æ˜¯æœ€ä½³å…¼å®¹æ¨¡å‹ï¼›
* âš™ï¸ DeepSeek-R1 1.5b/7b åœ¨ç›¸åŒæ¡ä»¶ä¸‹æ— æ³•ç¨³å®šæ”¯æŒ Function Callï¼›
* ğŸ” åŠ å…¥è°ƒç”¨æ­¥æ•°ä¸Šé™ä¸ prompt é™åˆ¶ï¼Œé˜²æ­¢æ­»å¾ªç¯ï¼›
* ğŸ§± æœªæ¥å¯æ‰©å±•æ›´å¤šå·¥å…·ï¼ˆæ–‡ä»¶è¯»å†™ã€çŸ¥è¯†åº“æ£€ç´¢ç­‰ï¼‰ã€‚

---

## ğŸ§¾ License

MIT Licenseï¼ˆè‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œæ‰©å±•ï¼‰
## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=StephenCurry885/100-local-MCP-Client&type=date&legend=top-left)](https://www.star-history.com/?utm_source=chatgpt.com#StephenCurry885/100-local-MCP-Client&type=date&legend=top-left)


